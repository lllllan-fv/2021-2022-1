
# 火车售票管理系统

鉴于【软件工程】的大作业是火车票票管理系统，这学期打算将【JSP】、【Android】都用这个主题。

只是后两门课程老师似乎没有很明确的要求，貌似只要扣住课程内容就行，做到什么程度用到什么内容也没提过。所以暂时就依照【软件工程】的设计完成基本的客户端和管理端的内容

## 火车座位问题

---

如果每个座位要分站点出售，关于座位分配的算法可能有点棘手，而且数据库也不知道要怎么实现。

以及火车票的查询也是一个问题：一列火车途径多站，如果出发站和目的站不是一列火车的起始站点，该如何查询到这列火车。

**为了简化问题，将火车途径站点简化为只有起点和终点两站。**

#### [数据库设计参考](https://blog.csdn.net/baidu_41871794/article/details/105779222)


## 客户端

---

#### 涉及事件

|   事件名称   |  涉及对象  |       涉及数据表       |                                                                注意事项                                                                |
| :----------: | :--------: | :--------------------: | :------------------------------------------------------------------------------------------------------------------------------------: |
|   用户注册   |    用户    |       用户信息表       |                                                   【用户】仅仅是登录客户端的一个账号                                                   |
|   用户登录   |    用户    |       用户信息表       |
|   修改密码   |    用户    |       用户信息表       |
|   找回密码   |    用户    |       用户信息表       |                                                         通过什么手段找回密码？                                                         |
|   乘客注册   |    乘客    |       乘客信息表       |                                                        【乘客】是乘坐火车的主体                                                        |
|   查询车票   |    车票    | 火车信息表、火车运行表 |                                                    涉及运行时间段、剩余座位、经过站                                                    |
|   购买车票   | 车票、乘客 |   订单表、车票信息表   | 【订单表】记录用户、乘客、车票的对应关系，【车票信息表】记录车票的详细信息，**考虑多线程**，注意乘客的空闲时间，没有直达考虑换乘的问题 |
|   车票改签   | 车票、乘客 |         订单表         |                                                                  同上                                                                  |
|   车票退订   |    车票    |         订单表         |
|   查询行程   | 用户、乘客 |         订单表         |                                                        是否要考虑行程隐私的问题                                                        |
| 查看历史订单 | 用户、乘客 |         订单表         |                                                   注意订单状态（未完成、取消、完成）                                                   |


#### 涉及页面

|     页面     |                          事件                          |
| :----------: | :----------------------------------------------------: |
| 用户注册页面 |                        用户注册                        |
| 用户登录页面 |                        用户登录                        |
| 修改密码页面 |                        修改密码                        |
| 找回密码页面 |                        找回密码                        |
|     主页     | 包含搜寻火车票、查看历史订单、修改个人信息、注册乘客等 |
| 乘客注册页面 |                        乘客注册                        |
|   查找页面   |                 根据起始站点搜寻火车票                 |
|   购买页面   |                确定乘客、行程，购买车票                |
|   改签页面   |                        车票改签                        |
|   退订页面   |                        车票退订                        |
| 未来行程页面 |                   查看乘客未来的行程                   |
| 历史订单页面 |                    查看用户历史订单                    |


## 管理端

----

#### 涉及事件

|    事件名称    |  涉及对象  |       涉及数据表       |                                                                注意事项                                                                |
| :------------: | :--------: | :--------------------: | :------------------------------------------------------------------------------------------------------------------------------------: |
|    管理火车    |    火车    |       火车信息表       |                                            添加、删除火车，修改火车起始站、终点站、运行时间                                            |
|    管理车次    |    火车    |       火车运行表       | 区别【火车】和【运行车次】，运行班次是一列火车某次具体的活动。添加、删除车次，修改车次状态【延误、取消、完成】、实际发车时间、车箱数、 |
| 管理用户、乘客 | 用户、乘客 | 用户信息表、乘客信息表 |

#### 涉及页面

|     页面     |   事件   |
| :----------: | :------: |
| 火车管理页面 | 管理火车 |
| 车次管理页面 | 管理车次 |
| 用户管理页面 | 管理用户 |
| 乘客管理页面 | 管理乘客 |


## 数据库设计

-----

#### [ER图绘制](https://gitmind.cn/app/flowchart/a135b9326c2bbe415101bfefd7470cfb)


#### 用户信息表


|      名称      |  类型   | 主键  |                      注释                       |
| :------------: | :-----: | :---: | :---------------------------------------------: |
| **user_keyid** |   int   |  是   |                    用户编号                     |
|    user_tel    |   int   |  是   |                  用户手机号码                   |
|   user_name    | varchar |  否   |                    用户昵称                     |
|   user_type    | varchar |  否   | 用户类型【普通用户 \| VIP用户 \| 管理员 \| 等】 |
|    user_pwd    | varchar |  否   |                    用户密码                     |

#### 乘客信息表


|           名称           |  类型   | 主键  |                  注释                  |
| :----------------------: | :-----: | :---: | :------------------------------------: |
|   **passenger_keyid**    |   int   |  是   |                乘客编号                |
| passenger_license_number | varchar |  是   |                 证件号                 |
|  passenger_license_type  | varchar |  否   |                证件类型                |
|      passenger_name      | varchar |  否   |                乘客姓名                |
|      passenger_type      | varchar |  否   | 乘客类型【成人 \| 儿童 \| 军人 \| 等】 |
|     passenger_limit      | varchar |  否   |    乘客权限【正常 \| 限制 \| 禁止】    |

#### 用户-乘客对应表

|        名称         | 类型  | 主键  |   注释   |
| :-----------------: | :---: | :---: | :------: |
|   **user_keyid**    |  int  |  否   | 用户编号 |
| **passenger_keyid** |  int  |  否   | 乘客编号 |


#### 列车信息表

|           名称            |  类型   | 主键  |                       注释                       |
| :-----------------------: | :-----: | :---: | :----------------------------------------------: |
|      **trai_keyid**       |   int   |  是   |                     列车编号                     |
|        train_type         | varchar |  否   | 列车类型【动车 \| 高铁 \| 城际列车 \| 直达列车】 |
|  train_departure_station  | varchar |  否   |                      始发站                      |
| train_destination_station | varchar |  否   |                      目的站                      |

#### 往返时刻表


|         名称         |   类型   | 主键  |           注释           |
| :------------------: | :------: | :---: | :----------------------: |
| **round_trip_keyid** |   int    |  是   |         往返编号         |
|   **train_keyid**    |   int    |  否   |         列车编号         |
|   round_trip_type    | varchar  |  否   | 往返类型【启程 \| 返程】 |
|    departure_time    | datetime |  否   |         发车时间         |
|     arrive_time      | datetime |  否   |         到达时间         |

#### 车次信息表


|            名称             |   类型   | 主键  |                       注释                       |
| :-------------------------: | :------: | :---: | :----------------------------------------------: |
|   **train_number_keyid**    |   int    |  是   |                     车次编号                     |
|    **round_trip_keyid**     |   int    |  否   |                     往返编号                     |
| train_number_departure_time | datetime |  否   |  实际发车日期和时间（延误或取消需要修改该时间）  |
|     train_number_state      | varchar  |  否   | 状态【未开始 \| 延误 \| 取消 \| 运行 \| 已完成】 |

#### 车次车厢表


|          名称          |  类型   | 主键  |                                          注释                                          |
| :--------------------: | :-----: | :---: | :------------------------------------------------------------------------------------: |
|   **seat_car_keyid**   |   int   |  是   |                                        车厢编号                                        |
| **train_number_keyid** |   int   |  否   |                                        车次编号                                        |
|      seat_car_id       |   int   |  否   |                                         车厢号                                         |
|     seat_car_type      | varchar |  否   | 车厢类型【硬座 \| 软座 \| 硬卧 \| 软卧 \| 一等 \| 二等 \| 等等】（直接决定了座位类型） |
| seat_car_seats_number  |   int   |  否   |                                        座位数量                                        |
|  seat_car_seats_price  |   int   |  否   |                                  车厢中每个座位的单价                                  |

#### 车次座位表

对应每次车次，具体每个座位的出售状态


|        名称        |  类型   | 主键  |               注释               |
| :----------------: | :-----: | :---: | :------------------------------: |
|   **seat_keyid**   |   int   |  是   |           车次座位编号           |
| **seat_car_keyid** |   int   |  是   |             车厢编号             |
|      seat_id       | varchar |  否   |    座位号【1A  \| 1B \| 等】     |
|     seat_state     | varchar |  否   | 座位状态【可售 \| 禁止 \| 已售】 |

#### 订单表


|        名称         | 类型  | 主键  |       注释       |
| :-----------------: | :---: | :---: | :--------------: |
|   **order_keyid**   |  int  |  是   |     订单编号     |
|   **user_keyid**    |  int  |  否   | 用户编号（购票人 |
| **passenger_keyid** |  int  |  否   | 乘客编号（乘车人 |
|   **seat_keyid**    |  int  |  否   |     座位编号     |